{
    "agent_name": "United home service",
    "channel": "voice",
    "last_modification_timestamp": 1771321915274,
    "response_engine": {
        "type": "conversation-flow",
        "version": 0,
        "conversation_flow_id": "conversation_flow_97128821c953"
    },
    "language": "en-US",
    "data_storage_setting": "everything",
    "opt_in_signed_url": false,
    "version": 0,
    "is_published": false,
    "post_call_analysis_model": "gpt-4.1-mini",
    "pii_config": {
        "mode": "post_call",
        "categories": []
    },
    "voice_id": "11labs-Andrew",
    "max_call_duration_ms": 3600000,
    "interruption_sensitivity": 0.9,
    "begin_message_delay_ms": 1000,
    "allow_user_dtmf": true,
    "user_dtmf_options": {},
    "conversationFlow": {
        "conversation_flow_id": "conversation_flow_97128821c953",
        "version": 0,
        "global_prompt": "You are Alex, a friendly and professional AI receptionist for United Home Services in Metro Charlotte, NC.\n\nSERVICES & PRICING (check KB for details):\n- Chimney Cleaning: $249\n- Dryer Vent Cleaning: $149\n- Gutter Cleaning: $199\n- Power Washing: $299\n- Air Duct Cleaning: $399 per system\n\nCRITICAL RULES:\n1. Retry failed tool calls up to 2 times before telling the customer there's an issue.\n2. For ANY service question, pricing, or complaint scenario, ALWAYS check the Knowledge Base FIRST.\n3. ALWAYS read back the verified address to the caller and ask them to confirm it.\n4. ALWAYS ask: 'Is anyone in the household military, veteran, or a senior citizen?' BEFORE quoting the price. If yes, apply 10% discount automatically.\n5. Never admit fault. Never discuss refunds. Never promise a specific refund amount.\n6. If user is angry, frustrated, or asks for a manager/human, transfer immediately using transfer_call.\n7. Be conversational, warm, and human-like. Avoid robotic lists. Use natural transitions.\n8. When quoting times, say the day and time naturally like 'Tuesday at 10 AM' not ISO format.",
        "nodes": [
            {
                "instruction": {
                    "type": "prompt",
                    "text": "Greet the caller warmly: 'Thank you for calling United Home Services, this is Alex! How can I help you today?'\n\nListen carefully to classify their intent:\n- If they mention booking, scheduling, pricing, quotes, new service, or any service name -> transition to Sales_State\n- If they mention a past job, complaint, issue, problem, redo, cancel, or dissatisfaction -> transition to Support_State\n- If unclear, ask: 'Are you looking to book a new service, or are you calling about a previous appointment?'\n\nFor general service questions, check the Knowledge Base first and answer directly."
                },
                "model_choice": {
                    "type": "cascading",
                    "model": "gemini-3.0-flash",
                    "high_priority": false
                },
                "name": "Root_State",
                "edges": [
                    {
                        "destination_node_id": "node-1770285939818",
                        "id": "edge-1",
                        "transition_condition": {
                            "type": "prompt",
                            "prompt": "User wants a new service or booking."
                        }
                    },
                    {
                        "destination_node_id": "node-1770286012250",
                        "id": "edge-2",
                        "transition_condition": {
                            "type": "prompt",
                            "prompt": "User has an existing issue or complaint."
                        }
                    }
                ],
                "start_speaker": "agent",
                "id": "start-node-1770283118544",
                "type": "conversation",
                "display_position": {
                    "x": 280.1470116540058,
                    "y": 425.0474729269436
                }
            },
            {
                "name": "End Call",
                "id": "end-call-node-1770283118544",
                "type": "end",
                "display_position": {
                    "x": 2250.0727524899885,
                    "y": 1371.2266821867518
                },
                "instruction": {
                    "type": "prompt",
                    "text": "Say: \"Thank you so much for calling United Home Services! If you need anything else, don't hesitate to call us back. Have a wonderful day!\" End the call warmly."
                }
            },
            {
                "instruction": {
                    "type": "prompt",
                    "text": "You are the Sales Specialist. IMPORTANT: Do NOT mention any price until after Step 3. Check the Knowledge Base for pricing details and how to handle customer objections.\n\nSTEP 1 - IDENTIFY SERVICE:\nAsk what service they're interested in. Match to one of our 5 services (Chimney $249, Dryer Vent $149, Gutter $199, Power Washing $299, Air Duct $399/system). If they're unsure, briefly describe our services and help them choose. Do NOT say the price yet.\n\nSTEP 2 - GET ADDRESS:\nAsk: 'What's the address where you need the service?'\nOnce they give it, call the verify_address tool.\nAFTER the tool returns, read the formatted_address back: 'I have [formatted_address]. Is that correct?'\nWait for confirmation. If wrong, ask them to repeat.\n\nSTEP 3 - DISCOUNT CHECK (MUST happen BEFORE any price is mentioned):\nAsk: 'Before I give you the pricing, is anyone in your household military, a veteran, or a senior citizen?'\nIf yes: Note the 10% discount and mention it when quoting.\n\nSTEP 4 - QUOTE PRICE:\nNOW you can quote the price. If they qualified for military/veteran/senior discount, say: 'We offer a 10% discount for military, veterans, and seniors, so your price would be [discounted price].' Otherwise quote the regular price.\nAsk: 'Does that work for you?'\n\nSTEP 5 - HANDLE HESITATION (if they push back on price):\nFor ALL services: Say 'Let me check with my manager on that, one moment please.' Pause 3 seconds. Then offer an additional 10% off. Say: 'Great news, my manager approved an additional 10% discount. That brings your total to [new price]. How does that sound?'\nFor Air Duct ONLY: If STILL hesitant after the extra 10%, pause 5 seconds and offer flat $199 per system as the absolute final offer.\n\nSTEP 6 - Price agreed -> transition to Availability_State.\n\nCRITICAL: Never ever mention a dollar amount before completing Step 3. Always check KB for customer handling guidance."
                },
                "model_choice": {
                    "type": "cascading",
                    "model": "gemini-3.0-flash",
                    "high_priority": false
                },
                "name": "Sales_State",
                "edges": [
                    {
                        "destination_node_id": "node-1770755689709",
                        "id": "edge-1770900385441-aloinyf9r",
                        "transition_condition": {
                            "type": "prompt",
                            "prompt": "User provided an address. Call verify_address tool now."
                        }
                    },
                    {
                        "destination_node_id": "node-1770753551246",
                        "id": "edge-1770900825431-oemhvk4rn",
                        "transition_condition": {
                            "type": "prompt",
                            "prompt": "User confirmed address AND agreed to price."
                        }
                    }
                ],
                "id": "node-1770285939818",
                "knowledge_base_ids": [],
                "type": "conversation",
                "display_position": {
                    "x": 770.818591997161,
                    "y": 32.476295911579996
                }
            },
            {
                "instruction": {
                    "type": "prompt",
                    "text": "You are the Support Specialist. ALWAYS identify the specific service first (duct cleaning, dryer vent, chimney, power washing, or gutter).\n\nThen check the Knowledge Base for the EXACT complaint scenario. The KB has 3 tiers:\n\nTIER 1 - EXPLAIN (no visit needed): Cosmetic, environmental, or expectation issues. Empathize and explain using the EXACT response from KB. Never admit fault. Examples: 'stains still visible', 'algae came back', 'service was too quick'.\n\nTIER 2 - FREE REDO: Missed work, incomplete cleaning, workmanship failures listed in KB. Say: 'I apologize for that experience. Let me get you scheduled for a return visit at no charge.' Then transition to Redo_Booking_State.\n\nTIER 3 - ESCALATE TO HUMAN: ANY mention of damage, safety, refund, chargeback, lawyer, BBB, insurance, or if the customer is upset/angry. Say: 'I completely understand your concern. Let me connect you with a team member who can help resolve this right away.' Then transfer immediately.\n\nFor tech behavior complaints (late, rushed, rude, unprofessional, no shoe covers, poor communication): Apologize sincerely and ask: 'I'm sorry about that. Would you like me to connect you with a team member to discuss this further?'\n\nALWAYS check KB before responding. Never guess."
                },
                "name": "Support_State",
                "model_choice": {
                    "type": "cascading",
                    "model": "gemini-3.0-flash",
                    "high_priority": false
                },
                "edges": [
                    {
                        "destination_node_id": "node-1770286048737",
                        "id": "edge-1770286012250-4p36r10e6",
                        "transition_condition": {
                            "type": "prompt",
                            "prompt": "Tier 3: Damage, safety, refund, or wants manager."
                        }
                    },
                    {
                        "destination_node_id": "node-1770643694251",
                        "id": "edge-1770643721803-xg9ki8p6a",
                        "transition_condition": {
                            "type": "prompt",
                            "prompt": "Customer wants to cancel an existing appointment."
                        }
                    },
                    {
                        "destination_node_id": "node-1771252057682",
                        "id": "edge-1771254814916-n9cfh2srd",
                        "transition_condition": {
                            "type": "prompt",
                            "prompt": "Tier 2: Missed work or redo needed."
                        }
                    }
                ],
                "id": "node-1770286012250",
                "knowledge_base_ids": [],
                "type": "conversation",
                "display_position": {
                    "x": 736.4375137829312,
                    "y": 1125.6650201902983
                }
            },
            {
                "custom_sip_headers": {},
                "transfer_destination": {
                    "type": "predefined",
                    "number": "+18563630633"
                },
                "edge": {
                    "destination_node_id": "end-call-node-1770283118544",
                    "id": "edge-1770286048737-53i002r5w",
                    "transition_condition": {
                        "type": "prompt",
                        "prompt": "Transfer failed"
                    }
                },
                "name": "Transfer Call",
                "ignore_e164_validation": false,
                "id": "node-1770286048737",
                "transfer_option": {
                    "type": "cold_transfer",
                    "show_transferee_as_caller": false,
                    "enable_bridge_audio_cue": true
                },
                "type": "transfer_call",
                "speak_during_execution": false,
                "display_position": {
                    "x": 1465.2988354256013,
                    "y": 1454.2099933871743
                }
            },
            {
                "tool_id": "tool-1770643690091",
                "else_edge": {
                    "destination_node_id": "end-call-node-1770283118544",
                    "id": "node-1770643694251-else-edge",
                    "transition_condition": {
                        "type": "prompt",
                        "prompt": "Else"
                    }
                },
                "name": "Cancel Appointment",
                "edges": [],
                "id": "node-1770643694251",
                "type": "function",
                "tool_type": "local",
                "speak_during_execution": false,
                "display_position": {
                    "x": 1800.8683359281813,
                    "y": 1452.6433169419415
                },
                "wait_for_result": true
            },
            {
                "instruction": {
                    "type": "prompt",
                    "text": "Ask: 'What date and time work best for you?'\n\nOnce they give a preferred date/time, call the find_technician_availability tool with their service_type, coordinates, and requested_datetime.\n\nIF the tool returns available=true:\nSay: 'Great news! We have [technician name] available on [day and time in natural language]. Would you like me to book that for you?'\nIf they agree -> transition to Book_State.\n\nIF the tool returns available=false with alternative_slots:\nSay: 'Unfortunately that specific time isn't available, but I do have some other options.' Then read out the alternative times in natural language (like 'Tuesday at 2 PM' not ISO format). Ask which one works.\nCall the tool again with the chosen time to confirm.\n\nIF the tool returns no technicians at all:\nSay: 'I'm sorry, we don't have anyone available for that date. Would you like to try a different day?'\n\nNever confirm a booking without calling the tool first. Always present times naturally."
                },
                "model_choice": {
                    "type": "cascading",
                    "model": "gemini-3.0-flash",
                    "high_priority": false
                },
                "name": "Availability_State",
                "edges": [
                    {
                        "destination_node_id": "node-1770753674935",
                        "id": "edge-1770753551247-vxiez83ws",
                        "transition_condition": {
                            "type": "prompt",
                            "prompt": "User has agreed to a specific time slot."
                        }
                    },
                    {
                        "destination_node_id": "node-1770755722581",
                        "id": "edge-1770900624414-c3t87fs1j",
                        "transition_condition": {
                            "type": "prompt",
                            "prompt": "User gave a preferred time. Call check_technician_availability now."
                        }
                    }
                ],
                "id": "node-1770753551246",
                "knowledge_base_ids": [],
                "type": "conversation",
                "display_position": {
                    "x": 1243.3176660721394,
                    "y": 192.21676355663158
                }
            },
            {
                "instruction": {
                    "type": "prompt",
                    "text": "You are completing the booking. You already have: verified address, agreed time slot, service type, and technician from context.\n\nSTEP 1: Ask for the customer's full name (if not already known).\nSTEP 2: Ask for their phone number.\nSTEP 3: Ask for their email address (say: 'And what's the best email to send the confirmation to?').\n\nSTEP 4: Call the book_appointment tool with all collected information.\n\nSTEP 5 - ON SUCCESS: Read back the FULL confirmation naturally:\n'Wonderful, you're all set! I've booked your [service_type] appointment at [address] on [date and time in natural language]. Your technician will be [technician name]. We'll send a confirmation to [phone number]. Is there anything else I can help you with?'\n\nSTEP 5 - ON ERROR: Say: 'I've recorded all your details and our team will reach out shortly to confirm your appointment. I apologize for the inconvenience.'\n\nAfter confirmation, transition to End Call.\nDo NOT re-ask for address or time. Do NOT skip the full readback."
                },
                "model_choice": {
                    "type": "cascading",
                    "model": "gemini-3.0-flash",
                    "high_priority": false
                },
                "name": "Book_State",
                "edges": [
                    {
                        "destination_node_id": "end-call-node-1770283118544",
                        "id": "edge-1770753674935-f7pvg7b4f",
                        "transition_condition": {
                            "type": "prompt",
                            "prompt": "Appointment is confirmed and call is wrapping up."
                        }
                    },
                    {
                        "destination_node_id": "node-1770755792494",
                        "id": "edge-1770900287792-ghlf7njkp",
                        "transition_condition": {
                            "type": "prompt",
                            "prompt": "Have name and phone. Call book_appointment tool now."
                        }
                    }
                ],
                "id": "node-1770753674935",
                "knowledge_base_ids": [],
                "type": "conversation",
                "display_position": {
                    "x": 1794.4761034033354,
                    "y": 184.48594683825894
                }
            },
            {
                "tool_id": "tool-1770754076296",
                "else_edge": {
                    "destination_node_id": "node-1770285939818",
                    "id": "node-1770755689709-else-edge",
                    "transition_condition": {
                        "type": "prompt",
                        "prompt": "Else"
                    }
                },
                "name": "verify_address",
                "edges": [],
                "id": "node-1770755689709",
                "type": "function",
                "tool_type": "local",
                "speak_during_execution": false,
                "display_position": {
                    "x": 774.9770950267863,
                    "y": 631.4298604577001
                },
                "wait_for_result": true
            },
            {
                "tool_id": "tool-1770754520685",
                "else_edge": {
                    "destination_node_id": "node-1770753551246",
                    "id": "node-1770755722581-else-edge",
                    "transition_condition": {
                        "type": "prompt",
                        "prompt": "Else"
                    }
                },
                "name": "check_technician_availability",
                "edges": [],
                "id": "node-1770755722581",
                "type": "function",
                "tool_type": "local",
                "speak_during_execution": false,
                "display_position": {
                    "x": 1245.0901376559452,
                    "y": 737.8524391137191
                },
                "wait_for_result": true
            },
            {
                "tool_id": "tool-1770642855470",
                "else_edge": {
                    "destination_node_id": "node-1770753674935",
                    "id": "node-1770755792494-else-edge",
                    "transition_condition": {
                        "type": "prompt",
                        "prompt": "Else"
                    }
                },
                "name": "book_appointment",
                "edges": [],
                "id": "node-1770755792494",
                "type": "function",
                "tool_type": "local",
                "speak_during_execution": false,
                "display_position": {
                    "x": 1788.456245767616,
                    "y": 685.7250058938187
                },
                "wait_for_result": true
            },
            {
                "instruction": {
                    "type": "prompt",
                    "text": "You are handling a FREE redo appointment. This is at NO CHARGE to the customer - make that clear.\n\nSTEP 1: Ask: 'Do you have your order ID or confirmation number from the original service?' If not, say: 'No problem, I can look it up with your phone number.'\n\nSTEP 2: Ask them to briefly describe the issue. Be empathetic: 'I'm sorry you experienced that.'\n\nSTEP 3: Call the book_redo_appointment tool with the order_id (or phone number) and their issue_description.\n\nON SUCCESS: Read back the redo details: 'I've scheduled your free return visit for [date and time] at [address]. The same technician will be coming back to take care of this for you at no charge.'\n\nON ERROR: Say: 'I'm having trouble scheduling that right now. Let me connect you with someone who can help.' Then transfer to human.\n\nNever charge the customer for a redo. Always emphasize it's free."
                },
                "model_choice": {
                    "type": "cascading",
                    "model": "gemini-3.0-flash",
                    "high_priority": false
                },
                "name": "Redo_Booking_State",
                "edges": [
                    {
                        "destination_node_id": "node-1771254791814",
                        "id": "edge-1771252057682-thvrnobnw",
                        "transition_condition": {
                            "type": "prompt",
                            "prompt": "Have order_id and issue_description. Call book_redo_appointment now."
                        }
                    }
                ],
                "id": "node-1771252057682",
                "knowledge_base_ids": [],
                "type": "conversation",
                "display_position": {
                    "x": 1108.3577402678966,
                    "y": 1121.794796244816
                }
            },
            {
                "tool_id": "tool-1771254788507",
                "else_edge": {
                    "destination_node_id": "end-call-node-1770283118544",
                    "id": "node-1771254791814-else-edge",
                    "transition_condition": {
                        "type": "prompt",
                        "prompt": "Else"
                    }
                },
                "name": "Book Redo Appointment",
                "edges": [],
                "id": "node-1771254791814",
                "type": "function",
                "tool_type": "local",
                "speak_during_execution": false,
                "display_position": {
                    "x": 1609.1551590004196,
                    "y": 1168.0161456544927
                },
                "wait_for_result": true
            }
        ],
        "start_node_id": "start-node-1770283118544",
        "start_speaker": "agent",
        "tools": [
            {
                "headers": {},
                "parameter_type": "json",
                "method": "POST",
                "query_params": {},
                "description": "Verifies and geocodes a messy address into structured data.",
                "type": "custom",
                "url": "http://3.231.241.26:8000/api/appointments/verify-address",
                "tool_id": "tool-1770754076296",
                "args_at_root": true,
                "timeout_ms": 20000,
                "name": "verify_address",
                "response_variables": {
                    "formatted_address": "$.formatted_address",
                    "latitude": "$.latitude",
                    "longitude": "$.longitude"
                },
                "parameters": {
                    "type": "object",
                    "required": [
                        "messy_input"
                    ],
                    "properties": {
                        "messy_input": {
                            "type": "string",
                            "description": "The raw address or zip code the user spoke."
                        }
                    }
                }
            },
            {
                "headers": {},
                "parameter_type": "json",
                "method": "POST",
                "query_params": {},
                "description": "Finds the nearest available technician for the requested service, location, and time.",
                "type": "custom",
                "url": "http://3.231.241.26:8000/api/appointments/find-technician-availability",
                "tool_id": "tool-1770754520685",
                "args_at_root": true,
                "timeout_ms": 20000,
                "name": "check_technician_availability",
                "response_variables": {
                    "technician_id": "$.technician.id",
                    "technician_name": "$.technician.name",
                    "time_slot": "$.time_slot",
                    "available": "$.available",
                    "alternative_slots": "$.alternative_slots"
                },
                "parameters": {
                    "type": "object",
                    "required": [
                        "service_type",
                        "confirmed_latitude",
                        "confirmed_longitude",
                        "requested_datetime"
                    ],
                    "properties": {
                        "service_type": {
                            "type": "string",
                            "enum": [
                                "chimney",
                                "dryer_vent",
                                "gutter",
                                "power_washing",
                                "air_duct"
                            ],
                            "description": "The service type. Must be one of: chimney, dryer_vent, gutter, power_washing, air_duct."
                        },
                        "confirmed_latitude": {
                            "type": "number",
                            "description": "Latitude from verify_address response."
                        },
                        "confirmed_longitude": {
                            "type": "number",
                            "description": "Longitude from verify_address response."
                        },
                        "requested_datetime": {
                            "type": "string",
                            "description": "ISO 8601 datetime the customer wants."
                        }
                    }
                }
            },
            {
                "headers": {},
                "parameter_type": "json",
                "method": "POST",
                "query_params": {},
                "description": "Books the appointment with all collected data.",
                "type": "custom",
                "url": "http://3.231.241.26:8000/api/appointments/book-appointment",
                "tool_id": "tool-1770642855470",
                "args_at_root": true,
                "timeout_ms": 20000,
                "name": "book_appointment",
                "response_variables": {
                    "appointment_id": "$.appointment_id",
                    "message": "$.message"
                },
                "parameters": {
                    "type": "object",
                    "required": [
                        "customer_name",
                        "customer_phone",
                        "customer_email",
                        "technician_id",
                        "service_type",
                        "address",
                        "latitude",
                        "longitude",
                        "start_time",
                        "duration_minutes"
                    ],
                    "properties": {
                        "customer_name": {
                            "type": "string",
                            "description": ""
                        },
                        "customer_phone": {
                            "type": "string",
                            "description": ""
                        },
                        "customer_email": {
                            "type": "string",
                            "description": ""
                        },
                        "technician_id": {
                            "type": "number",
                            "description": ""
                        },
                        "service_type": {
                            "type": "string",
                            "enum": [
                                "chimney",
                                "dryer_vent",
                                "gutter",
                                "power_washing",
                                "air_duct"
                            ],
                            "description": "The service type. Must be one of: chimney, dryer_vent, gutter, power_washing, air_duct."
                        },
                        "address": {
                            "type": "string",
                            "description": ""
                        },
                        "latitude": {
                            "type": "number",
                            "description": ""
                        },
                        "longitude": {
                            "type": "number",
                            "description": ""
                        },
                        "start_time": {
                            "type": "string",
                            "description": ""
                        },
                        "duration_minutes": {
                            "type": "number",
                            "description": ""
                        }
                    }
                }
            },
            {
                "headers": {},
                "parameter_type": "json",
                "method": "POST",
                "query_params": {},
                "description": "Cancels the customer's upcoming appointment by their phone number.",
                "type": "custom",
                "url": "http://3.231.241.26:8000/api/appointments/cancel-appointment",
                "tool_id": "tool-1770643690091",
                "args_at_root": true,
                "timeout_ms": 20000,
                "name": "cancel_appointment",
                "response_variables": {},
                "parameters": {
                    "type": "object",
                    "required": [
                        "phone_number"
                    ],
                    "properties": {
                        "phone_number": {
                            "type": "string",
                            "description": "The user's phone number to identify the booking."
                        },
                        "cancellation_reason": {
                            "type": "string",
                            "description": "The reason why the user wants to cancel (optional)."
                        }
                    }
                }
            },
            {
                "headers": {},
                "parameter_type": "json",
                "method": "POST",
                "query_params": {},
                "description": "Books a free redo appointment using Order ID or phone number lookup.",
                "type": "custom",
                "url": "http://3.231.241.26:8000/api/appointments/book-redo-appointment",
                "tool_id": "tool-1771254788507",
                "args_at_root": true,
                "timeout_ms": 20000,
                "name": "book_redo_appointment",
                "response_variables": {},
                "parameters": {
                    "type": "object",
                    "required": [
                        "order_id",
                        "issue_description"
                    ],
                    "properties": {
                        "order_id": {
                            "type": "string",
                            "description": "The Order ID or Invoice Number provided by the customer."
                        },
                        "issue_description": {
                            "type": "string",
                            "description": "Brief description of why a redo is needed."
                        }
                    }
                }
            }
        ],
        "model_choice": {
            "type": "cascading",
            "model": "gemini-3.0-flash",
            "high_priority": false
        },
        "tool_call_strict_mode": true,
        "knowledge_base_ids": [],
        "kb_config": {
            "top_k": 3,
            "filter_score": 0.6
        },
        "begin_tag_display_position": {
            "x": 112.76923076923075,
            "y": 348.38461538461536
        },
        "is_published": false,
        "flex_mode": true,
        "is_transfer_cf": false
    }
}