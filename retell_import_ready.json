{
    "agent_name": "United home service",
    "channel": "voice",
    "last_modification_timestamp": 1771321915274,
    "response_engine": {
        "type": "conversation-flow",
        "version": 0,
        "conversation_flow_id": "conversation_flow_97128821c953"
    },
    "language": "en-US",
    "data_storage_setting": "everything",
    "opt_in_signed_url": false,
    "version": 0,
    "is_published": false,
    "post_call_analysis_model": "gpt-4.1-mini",
    "pii_config": {
        "mode": "post_call",
        "categories": []
    },
    "voice_id": "11labs-Andrew",
    "max_call_duration_ms": 3600000,
    "interruption_sensitivity": 0.9,
    "begin_message_delay_ms": 1000,
    "allow_user_dtmf": true,
    "user_dtmf_options": {},
    "conversationFlow": {
        "conversation_flow_id": "conversation_flow_97128821c953",
        "version": 0,
        "global_prompt": "You are Alex, AI receptionist for United Home Services, Metro Charlotte.\n\nSERVICES: Chimney ($249), Dryer Vent ($149), Gutter ($199), Power Washing ($299), Air Duct ($399/system).\n\nRULES:\n- Retry failed tool calls up to 2 times.\n- For ANY service question, pricing, or complaint scenario, ALWAYS check the Knowledge Base FIRST.\n- Never admit fault. Never discuss refunds. Escalate early for damage/safety.\n- If user is angry or asks for a human, transfer immediately.\n- Be concise, professional, warm.",
        "nodes": [
            {
                "instruction": {
                    "type": "prompt",
                    "text": "Say: \"Thank you for calling United Home Services, this is Alex. How can I help you today?\"\nRoute: new service -> Sales_State, existing issue -> Support_State.\nIf unclear: \"Are you looking to book a new service or calling about a past job?\""
                },
                "model_choice": {
                    "type": "cascading",
                    "model": "gemini-3.0-flash",
                    "high_priority": false
                },
                "name": "Root_State",
                "edges": [
                    {
                        "destination_node_id": "node-1770285939818",
                        "id": "edge-1",
                        "transition_condition": {
                            "type": "prompt",
                            "prompt": "User wants a new service or booking."
                        }
                    },
                    {
                        "destination_node_id": "node-1770286012250",
                        "id": "edge-2",
                        "transition_condition": {
                            "type": "prompt",
                            "prompt": "User has an existing issue or complaint."
                        }
                    }
                ],
                "start_speaker": "agent",
                "id": "start-node-1770283118544",
                "type": "conversation",
                "display_position": {
                    "x": 280.1470116540058,
                    "y": 425.0474729269436
                }
            },
            {
                "name": "End Call",
                "id": "end-call-node-1770283118544",
                "type": "end",
                "display_position": {
                    "x": 2250.0727524899885,
                    "y": 1371.2266821867518
                },
                "instruction": {
                    "type": "prompt",
                    "text": "Say: \"Thank you so much for calling United Home Services! If you need anything else, don't hesitate to call us back. Have a wonderful day!\" End the call warmly."
                }
            },
            {
                "instruction": {
                    "type": "prompt",
                    "text": "1. Ask what service they need. Match to one of our 5 services. Check KB for pricing.\n2. Ask for address -> call verify_address tool. Read back formatted address, confirm with customer.\n3. Quote the KB price. Ask if it works for them.\n4. DISCOUNT FLOW if hesitant:\n   a. First: Ask if military/veteran/senior in household -> 10% off all services.\n   b. If still hesitant:\n      - Chimney/Dryer Vent: No further discount. Reiterate value and competitive pricing.\n      - Air Duct: Say 'Let me check with my manager', pause 3 seconds, offer additional 10% off. If STILL hesitant, pause 5 seconds, offer flat $199/system as final offer.\n      - Gutter/Power Washing: Say 'Let me check with my manager', pause 3 seconds, offer additional 10% off.\n5. Price agreed -> transition to Availability_State.\nCheck KB for all pricing and discount details."
                },
                "model_choice": {
                    "type": "cascading",
                    "model": "gemini-3.0-flash",
                    "high_priority": false
                },
                "name": "Sales_State",
                "edges": [
                    {
                        "destination_node_id": "node-1770755689709",
                        "id": "edge-1770900385441-aloinyf9r",
                        "transition_condition": {
                            "type": "prompt",
                            "prompt": "User provided an address. Call verify_address tool now."
                        }
                    },
                    {
                        "destination_node_id": "node-1770753551246",
                        "id": "edge-1770900825431-oemhvk4rn",
                        "transition_condition": {
                            "type": "prompt",
                            "prompt": "User confirmed address AND agreed to price."
                        }
                    }
                ],
                "id": "node-1770285939818",
                "knowledge_base_ids": [],
                "type": "conversation",
                "display_position": {
                    "x": 770.818591997161,
                    "y": 32.476295911579996
                }
            },
            {
                "instruction": {
                    "type": "prompt",
                    "text": "Identify the service the complaint is about, then check KB for the exact scenario.\n\nTier 1 EXPLAIN (no visit): Expectation/cosmetic/environmental issues. Empathize, explain using KB answers. Never admit fault.\nTier 2 REDO (free): Missed work, incomplete cleaning, workmanship issues per KB list -> apologize, go to Redo_Booking_State.\nTier 3 ESCALATE: Any damage, safety, money/refund, legal keywords -> transfer to human immediately.\n\nFor tech behavior complaints (late, rushed, rude, no shoe covers): apologize and ask if they'd like to speak to a human.\nALWAYS check KB for the specific service + scenario before responding."
                },
                "name": "Support_State",
                "model_choice": {
                    "type": "cascading",
                    "model": "gemini-3.0-flash",
                    "high_priority": false
                },
                "edges": [
                    {
                        "destination_node_id": "node-1770286048737",
                        "id": "edge-1770286012250-4p36r10e6",
                        "transition_condition": {
                            "type": "prompt",
                            "prompt": "Tier 3: Damage, safety, refund, or wants manager."
                        }
                    },
                    {
                        "destination_node_id": "node-1770643694251",
                        "id": "edge-1770643721803-xg9ki8p6a",
                        "transition_condition": {
                            "type": "prompt",
                            "prompt": "Customer wants to cancel an existing appointment."
                        }
                    },
                    {
                        "destination_node_id": "node-1771252057682",
                        "id": "edge-1771254814916-n9cfh2srd",
                        "transition_condition": {
                            "type": "prompt",
                            "prompt": "Tier 2: Missed work or redo needed."
                        }
                    }
                ],
                "id": "node-1770286012250",
                "knowledge_base_ids": [],
                "type": "conversation",
                "display_position": {
                    "x": 736.4375137829312,
                    "y": 1125.6650201902983
                }
            },
            {
                "custom_sip_headers": {},
                "transfer_destination": {
                    "type": "predefined",
                    "number": "+18563630633"
                },
                "edge": {
                    "destination_node_id": "end-call-node-1770283118544",
                    "id": "edge-1770286048737-53i002r5w",
                    "transition_condition": {
                        "type": "prompt",
                        "prompt": "Transfer failed"
                    }
                },
                "name": "Transfer Call",
                "ignore_e164_validation": false,
                "id": "node-1770286048737",
                "transfer_option": {
                    "type": "cold_transfer",
                    "show_transferee_as_caller": false,
                    "enable_bridge_audio_cue": true
                },
                "type": "transfer_call",
                "speak_during_execution": false,
                "display_position": {
                    "x": 1465.2988354256013,
                    "y": 1454.2099933871743
                }
            },
            {
                "tool_id": "tool-1770643690091",
                "else_edge": {
                    "destination_node_id": "end-call-node-1770283118544",
                    "id": "node-1770643694251-else-edge",
                    "transition_condition": {
                        "type": "prompt",
                        "prompt": "Else"
                    }
                },
                "name": "Cancel Appointment",
                "edges": [],
                "id": "node-1770643694251",
                "type": "function",
                "tool_type": "local",
                "speak_during_execution": false,
                "display_position": {
                    "x": 1800.8683359281813,
                    "y": 1452.6433169419415
                },
                "wait_for_result": true
            },
            {
                "instruction": {
                    "type": "prompt",
                    "text": "Ask preferred date/time. Call check_technician_availability. If available and agreed -> Book_State. If busy, offer alternative_slots from response. Never confirm without calling tool first."
                },
                "model_choice": {
                    "type": "cascading",
                    "model": "gemini-3.0-flash",
                    "high_priority": false
                },
                "name": "Availability_State",
                "edges": [
                    {
                        "destination_node_id": "node-1770753674935",
                        "id": "edge-1770753551247-vxiez83ws",
                        "transition_condition": {
                            "type": "prompt",
                            "prompt": "User has agreed to a specific time slot."
                        }
                    },
                    {
                        "destination_node_id": "node-1770755722581",
                        "id": "edge-1770900624414-c3t87fs1j",
                        "transition_condition": {
                            "type": "prompt",
                            "prompt": "User gave a preferred time. Call check_technician_availability now."
                        }
                    }
                ],
                "id": "node-1770753551246",
                "knowledge_base_ids": [],
                "type": "conversation",
                "display_position": {
                    "x": 1243.3176660721394,
                    "y": 192.21676355663158
                }
            },
            {
                "instruction": {
                    "type": "prompt",
                    "text": "Get name and phone if missing. Call book_appointment. On success say: \"You're all set! [service] at [address] on [date/time] with [tech_name]. We'll text confirmation to [phone].\" On error: \"We've recorded your details, we'll text you a confirmation shortly.\" Then end call."
                },
                "model_choice": {
                    "type": "cascading",
                    "model": "gemini-3.0-flash",
                    "high_priority": false
                },
                "name": "Book_State",
                "edges": [
                    {
                        "destination_node_id": "end-call-node-1770283118544",
                        "id": "edge-1770753674935-f7pvg7b4f",
                        "transition_condition": {
                            "type": "prompt",
                            "prompt": "Appointment is confirmed and call is wrapping up."
                        }
                    },
                    {
                        "destination_node_id": "node-1770755792494",
                        "id": "edge-1770900287792-ghlf7njkp",
                        "transition_condition": {
                            "type": "prompt",
                            "prompt": "Have name and phone. Call book_appointment tool now."
                        }
                    }
                ],
                "id": "node-1770753674935",
                "knowledge_base_ids": [],
                "type": "conversation",
                "display_position": {
                    "x": 1794.4761034033354,
                    "y": 184.48594683825894
                }
            },
            {
                "tool_id": "tool-1770754076296",
                "else_edge": {
                    "destination_node_id": "node-1770285939818",
                    "id": "node-1770755689709-else-edge",
                    "transition_condition": {
                        "type": "prompt",
                        "prompt": "Else"
                    }
                },
                "name": "verify_address",
                "edges": [],
                "id": "node-1770755689709",
                "type": "function",
                "tool_type": "local",
                "speak_during_execution": false,
                "display_position": {
                    "x": 774.9770950267863,
                    "y": 631.4298604577001
                },
                "wait_for_result": true
            },
            {
                "tool_id": "tool-1770754520685",
                "else_edge": {
                    "destination_node_id": "node-1770753551246",
                    "id": "node-1770755722581-else-edge",
                    "transition_condition": {
                        "type": "prompt",
                        "prompt": "Else"
                    }
                },
                "name": "check_technician_availability",
                "edges": [],
                "id": "node-1770755722581",
                "type": "function",
                "tool_type": "local",
                "speak_during_execution": false,
                "display_position": {
                    "x": 1245.0901376559452,
                    "y": 737.8524391137191
                },
                "wait_for_result": true
            },
            {
                "tool_id": "tool-1770642855470",
                "else_edge": {
                    "destination_node_id": "node-1770753674935",
                    "id": "node-1770755792494-else-edge",
                    "transition_condition": {
                        "type": "prompt",
                        "prompt": "Else"
                    }
                },
                "name": "book_appointment",
                "edges": [],
                "id": "node-1770755792494",
                "type": "function",
                "tool_type": "local",
                "speak_during_execution": false,
                "display_position": {
                    "x": 1788.456245767616,
                    "y": 685.7250058938187
                },
                "wait_for_result": true
            },
            {
                "instruction": {
                    "type": "prompt",
                    "text": "Ask for Order ID or phone number. Call book_redo_appointment with order_id + issue_description. On success: confirm redo date/address from response. On error: transfer to human. This is FREE, no charge."
                },
                "model_choice": {
                    "type": "cascading",
                    "model": "gemini-3.0-flash",
                    "high_priority": false
                },
                "name": "Redo_Booking_State",
                "edges": [
                    {
                        "destination_node_id": "node-1771254791814",
                        "id": "edge-1771252057682-thvrnobnw",
                        "transition_condition": {
                            "type": "prompt",
                            "prompt": "Have order_id and issue_description. Call book_redo_appointment now."
                        }
                    }
                ],
                "id": "node-1771252057682",
                "knowledge_base_ids": [],
                "type": "conversation",
                "display_position": {
                    "x": 1108.3577402678966,
                    "y": 1121.794796244816
                }
            },
            {
                "tool_id": "tool-1771254788507",
                "else_edge": {
                    "destination_node_id": "end-call-node-1770283118544",
                    "id": "node-1771254791814-else-edge",
                    "transition_condition": {
                        "type": "prompt",
                        "prompt": "Else"
                    }
                },
                "name": "Book Redo Appointment",
                "edges": [],
                "id": "node-1771254791814",
                "type": "function",
                "tool_type": "local",
                "speak_during_execution": false,
                "display_position": {
                    "x": 1609.1551590004196,
                    "y": 1168.0161456544927
                },
                "wait_for_result": true
            }
        ],
        "start_node_id": "start-node-1770283118544",
        "start_speaker": "agent",
        "tools": [
            {
                "headers": {},
                "parameter_type": "json",
                "method": "POST",
                "query_params": {},
                "description": "Verifies and geocodes a messy address into structured data.",
                "type": "custom",
                "url": "http://3.231.241.26:8000/api/appointments/verify-address",
                "tool_id": "tool-1770754076296",
                "args_at_root": true,
                "timeout_ms": 20000,
                "name": "verify_address",
                "response_variables": {
                    "formatted_address": "$.formatted_address",
                    "latitude": "$.latitude",
                    "longitude": "$.longitude"
                },
                "parameters": {
                    "type": "object",
                    "required": [
                        "messy_input"
                    ],
                    "properties": {
                        "messy_input": {
                            "type": "string",
                            "description": "The raw address or zip code the user spoke."
                        }
                    }
                }
            },
            {
                "headers": {},
                "parameter_type": "json",
                "method": "POST",
                "query_params": {},
                "description": "Finds the nearest available technician for the requested service, location, and time.",
                "type": "custom",
                "url": "http://3.231.241.26:8000/api/appointments/find-technician-availability",
                "tool_id": "tool-1770754520685",
                "args_at_root": true,
                "timeout_ms": 20000,
                "name": "check_technician_availability",
                "response_variables": {
                    "technician_id": "$.technician.id",
                    "technician_name": "$.technician.name",
                    "time_slot": "$.time_slot",
                    "available": "$.available",
                    "alternative_slots": "$.alternative_slots"
                },
                "parameters": {
                    "type": "object",
                    "required": [
                        "service_type",
                        "confirmed_latitude",
                        "confirmed_longitude",
                        "requested_datetime"
                    ],
                    "properties": {
                        "service_type": {
                            "type": "string",
                            "description": "The service the customer needs."
                        },
                        "confirmed_latitude": {
                            "type": "number",
                            "description": "Latitude from verify_address response."
                        },
                        "confirmed_longitude": {
                            "type": "number",
                            "description": "Longitude from verify_address response."
                        },
                        "requested_datetime": {
                            "type": "string",
                            "description": "ISO 8601 datetime the customer wants."
                        }
                    }
                }
            },
            {
                "headers": {},
                "parameter_type": "json",
                "method": "POST",
                "query_params": {},
                "description": "Books the appointment with all collected data.",
                "type": "custom",
                "url": "http://3.231.241.26:8000/api/appointments/book-appointment",
                "tool_id": "tool-1770642855470",
                "args_at_root": true,
                "timeout_ms": 20000,
                "name": "book_appointment",
                "response_variables": {
                    "appointment_id": "$.appointment_id",
                    "message": "$.message"
                },
                "parameters": {
                    "type": "object",
                    "required": [
                        "customer_name",
                        "customer_phone",
                        "customer_email",
                        "technician_id",
                        "service_type",
                        "address",
                        "latitude",
                        "longitude",
                        "start_time",
                        "duration_minutes"
                    ],
                    "properties": {
                        "customer_name": {
                            "type": "string",
                            "description": ""
                        },
                        "customer_phone": {
                            "type": "string",
                            "description": ""
                        },
                        "customer_email": {
                            "type": "string",
                            "description": ""
                        },
                        "technician_id": {
                            "type": "number",
                            "description": ""
                        },
                        "service_type": {
                            "type": "string",
                            "description": ""
                        },
                        "address": {
                            "type": "string",
                            "description": ""
                        },
                        "latitude": {
                            "type": "number",
                            "description": ""
                        },
                        "longitude": {
                            "type": "number",
                            "description": ""
                        },
                        "start_time": {
                            "type": "string",
                            "description": ""
                        },
                        "duration_minutes": {
                            "type": "number",
                            "description": ""
                        }
                    }
                }
            },
            {
                "headers": {},
                "parameter_type": "json",
                "method": "POST",
                "query_params": {},
                "description": "Cancels the customer's upcoming appointment by their phone number.",
                "type": "custom",
                "url": "http://3.231.241.26:8000/api/appointments/cancel-appointment",
                "tool_id": "tool-1770643690091",
                "args_at_root": true,
                "timeout_ms": 20000,
                "name": "cancel_appointment",
                "response_variables": {},
                "parameters": {
                    "type": "object",
                    "required": [
                        "phone_number"
                    ],
                    "properties": {
                        "phone_number": {
                            "type": "string",
                            "description": "The user's phone number to identify the booking."
                        },
                        "cancellation_reason": {
                            "type": "string",
                            "description": "The reason why the user wants to cancel (optional)."
                        }
                    }
                }
            },
            {
                "headers": {},
                "parameter_type": "json",
                "method": "POST",
                "query_params": {},
                "description": "Books a free redo appointment using Order ID or phone number lookup.",
                "type": "custom",
                "url": "http://3.231.241.26:8000/api/appointments/book-redo-appointment",
                "tool_id": "tool-1771254788507",
                "args_at_root": true,
                "timeout_ms": 20000,
                "name": "book_redo_appointment",
                "response_variables": {},
                "parameters": {
                    "type": "object",
                    "required": [
                        "order_id",
                        "issue_description"
                    ],
                    "properties": {
                        "order_id": {
                            "type": "string",
                            "description": "The Order ID or Invoice Number provided by the customer."
                        },
                        "issue_description": {
                            "type": "string",
                            "description": "Brief description of why a redo is needed."
                        }
                    }
                }
            }
        ],
        "model_choice": {
            "type": "cascading",
            "model": "gemini-3.0-flash",
            "high_priority": false
        },
        "tool_call_strict_mode": true,
        "knowledge_base_ids": [],
        "kb_config": {
            "top_k": 3,
            "filter_score": 0.6
        },
        "begin_tag_display_position": {
            "x": 112.76923076923075,
            "y": 348.38461538461536
        },
        "is_published": false,
        "flex_mode": true,
        "is_transfer_cf": false
    }
}